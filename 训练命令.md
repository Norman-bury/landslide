# 训练命令 (单卡 A100-80GB)

`cd ~/heren/test/d_project` 后执行:

```bash
# 训练
CUDA_VISIBLE_DEVICES=5 python scripts/train.py --config configs/server.yaml

# 后台训练
nohup CUDA_VISIBLE_DEVICES=5 python scripts/train.py --config configs/server.yaml > train.log 2>&1 &
tail -f train.log

# 评测
CUDA_VISIBLE_DEVICES=5 python scripts/evaluate.py --checkpoint outputs/best_model.pth

# OOM 就降 batch
CUDA_VISIBLE_DEVICES=5 python scripts/train.py --config configs/server.yaml --batch-size 16

# ===== 双卡 DDP (每卡batch=24, 总batch=48) =====
CUDA_VISIBLE_DEVICES=4,5 torchrun --nproc_per_node=2 scripts/train.py --config configs/server.yaml

# 双卡后台
nohup bash -c "CUDA_VISIBLE_DEVICES=4,5 torchrun --nproc_per_node=2 scripts/train.py --config configs/server.yaml" > train.log 2>&1 &

# ===== 基线对比 =====
CUDA_VISIBLE_DEVICES=5 python scripts/train_baseline.py --model unet --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_baseline.py --model deeplabv3plus --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_baseline.py --model fcn --config configs/server.yaml

# ===== 消融实验 =====
# LoRA rank 对比
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation lora_rank --value 4 --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation lora_rank --value 8 --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation lora_rank --value 32 --config configs/server.yaml

# LoRA 插入层数对比 (ViT-L共24层, 只插最后N层)
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation lora_layers --value 3 --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation lora_layers --value 4 --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation lora_layers --value 5 --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation lora_layers --value 6 --config configs/server.yaml

# 不用 LoRA / 不用 Dice / 减少多尺度
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation no_lora --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation no_dice --config configs/server.yaml
CUDA_VISIBLE_DEVICES=5 python scripts/train_ablation.py --ablation no_fpn --config configs/server.yaml

# ===== 一键全部实验 + 汇总 =====
bash scripts/run_experiments.sh
python scripts/summarize_results.py

# ===== 恢复训练 =====
CUDA_VISIBLE_DEVICES=5 python scripts/train.py --config configs/server.yaml --resume outputs/best_model.pth
```
